services:
  prometheus:
    image: prom/prometheus:v2.22.2
    container_name: prometheus
    hostname: prometheus
    restart: unless-stopped
    networks:
      - flow
      - traefik
    labels:
      - traefik.enable=true
      - traefik.http.routers.Prometheus.entrypoints=prometheus
      - traefik.http.routers.Prometheus.rule=Host(`${FLOW_DOMAIN}`)
      - traefik.http.routers.Prometheus.tls=true
      - traefik.http.routers.Prometheus.tls.certresolver=letsencrypt
      - traefik.http.services.Prometheus.loadbalancer.server.port=9090
    command: --config.file=/etc/prometheus/prometheus.yml --web.enable-lifecycle --storage.tsdb.retention=${PROMETHEUS_RETENTION} --storage.tsdb.path /prometheus
    volumes:
      - /srv/docker/flow/config/prometheus:/etc/prometheus
      - /srv/docker/flow/monitoring/prometheus:/prometheus
      - /srv/docker/flow/monitoring:/etc/file_sd_configs