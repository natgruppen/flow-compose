services:
  deepstream:
    container_name: deepstream
    image: ${REPOSITORY}/bitvis.io-deepstream:2.3.6
    hostname: deepstream
    restart: unless-stopped
    #environment:
    networks:
      - flow
      - traefik
    ports:
      - 6020:6020
    labels:
      - traefik.enable=true
      - traefik.http.routers.Deepstream.entrypoints=https
      - traefik.http.routers.Deepstream.rule=PathPrefix(`/deepstream`) && Host(`${FLOW_DOMAIN}`)
      - traefik.http.routers.Deepstream.tls=true
      - traefik.http.services.Deepstream.loadbalancer.server.port=6020
    volumes:
      - /srv/docker/deepstream:/etc/deepstream
    healthcheck:
      test: wget -q -O /dev/null localhost:6020/health-check 
      interval: 1m30s
      timeout: 30s
      retries: 5
      start_period: 30s
    depends_on:
#      flow-auth:
#        condition: service_started
      rethinkdb:
        condition: service_started